<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.iei.hotel.reservation.mapper.ReservationMapper">
	
	<sql id="reservationColumns">
		 reservationNo
		,memberId
		,guestRoomName
		,guestRoomNo
		,checkIn
		,checkOut
		,lodgmentPeriod
		,totalPrice
		,adult
		,child
		,reservationDate
		,memberName
		,memberGrade
	</sql>
	<!-- 예약 insert 처리 -->
	<insert id="reservationInsertProcess" parameterType="kr.iei.hotel.reservation.vo.ReservationVO">
		INSERT INTO
		reservation (
			<include refid="reservationColumns"/>
		) VALUES (
			 #{reservationNo}
			,#{memberId}
			,#{guestRoomName}
			,#{guestRoomNo}
			,#{checkIn}
			,#{checkOut}
			,#{lodgmentPeriod}
			,#{totalPrice}
			,#{adult}
			,#{child}
			,SYSDATE
			,#{memberName}
			,#{memberGrade}
		)
	</insert>
	<!-- 예약 관리 리스트 -->
	<select id="reservationAdminList" resultType="kr.iei.hotel.reservation.vo.ReservationVO">
		SELECT *
		FROM reservation
	</select>
	<!-- 예약 관리 취소 -->
	<delete id="reservationAdminDelete" parameterType="String">
		DELETE
		FROM reservation
		WHERE reservationNo = #{reservationNo}
	</delete>
	<!-- 예약 관리 검색 -->
	<select id="reservationAdminSearch" parameterType="String" resultType="kr.iei.hotel.reservation.vo.ReservationVO">
		SELECT *
		FROM reservation
		WHERE reservationNo LIKE '%' || #{reservationNo} || '%'
	</select>
	<!-- 예약 개수 검색 -->
	<select id="selectReservationCount" parameterType="kr.iei.hotel.reservation.vo.ReservationVO" resultType="int">
		SELECT 	COUNT(*)
		FROM 	reservation
		WHERE 	(guestRoomName = #{guestRoomName})
		AND 	(checkIn >= #{checkIn})
		AND 	(checkIn &lt; #{checkOut})
		OR 		(guestRoomName = #{guestRoomName})
		AND 	(checkOut > #{checkIn})
		AND 	(checkOut &lt; #{checkOut})
		OR 		(guestRoomName = #{guestRoomName})
		AND 	(checkIn &lt;= #{checkIn})
		AND 	(checkOut >= #{checkOut})
		
	</select>
	<!-- 객실 정보 개수 검색 -->
	<select id="selectGuestRoomInfoCount" parameterType="kr.iei.hotel.reservation.vo.ReservationVO" resultType="int">
		SELECT 	COUNT(*)
		FROM 	guestRoomInfo
		WHERE 	guestRoomName = #{guestRoomName}
	</select>
	<!-- 객실 정보 리스트 -->
	<select id="selectGuestRoomInfoList" parameterType="kr.iei.hotel.reservation.vo.ReservationVO" resultType="kr.iei.hotel.guestroom.vo.GuestRoomVO">
		SELECT *
 		FROM guestRoom
 		JOIN guestRoomInfo
 		ON guestRoom.guestRoomName = guestRoomInfo.guestRoomName
 		WHERE guestRoom.guestRoomName = #{guestRoomName}
	</select>
	<!-- 예약 객실번호 리스트 -->
	<select id="reservationGuestRoomNumberList" parameterType="kr.iei.hotel.reservation.vo.ReservationVO" resultType="int">
		SELECT 	guestRoomNo
		FROM 	reservation
		WHERE 	(guestRoomName = #{guestRoomName})
		AND 	(checkIn >= #{checkIn})
		AND 	(checkIn &lt; #{checkOut})
		OR 		(guestRoomName = #{guestRoomName})
		AND 	(checkOut > #{checkIn})
		AND 	(checkOut &lt; #{checkOut})
		OR 		(guestRoomName = #{guestRoomName})
		AND 	(checkIn &lt;= #{checkIn})
		AND 	(checkOut >= #{checkOut})
	</select>
</mapper>